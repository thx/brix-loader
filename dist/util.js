define(function(){function t(){this.list=[]}function e(){var t=this;this.state="pending",this.resolvedList=[],this.resolvedListIndex=0,this.rejectedList=[],this.rejectedListIndex=0,this.progressedList=[],this.progressedListIndex=0,this.promise={then:function(){return t.then.apply(t,arguments),this},"finally":function(){return t.finally.apply(t,arguments),this}}}var n={},i=Array.prototype.slice,r=Array.prototype.concat,s=Object.prototype.toString,u=Object.prototype.hasOwnProperty;return n.each=function(t,e,n){if(null===t||void 0===t)return t;if(t.forEach)t.forEach(e,n);else if(t.length===+t.length)for(var i=0,r=t.length;r>i;i++)e.call(n,t[i],i,t);else for(var s in t)e.call(n,t[s],s,t);return t},n.map=function(t,e,i){var r=[];return null===t||void 0===t?r:t.map===Array.prototype.map?t.map(e,i):(n.each(t,function(t,n,s){r.push(e.call(i,t,n,s))}),r)},n.without=function(t){var e=[],r=i.call(arguments,1);return n.each(t,function(t){var i=!1;n.each(r,function(e){i||e!==t||(i=!0)}),i||e.push(t)}),e},n.unique=function(t){var e=[];return n.each(t.sort(),function(n,i){(0===i||n!==t[i-1])&&e.push(n)}),e},n.pick=function(t){var e={},s=r.apply([],i.call(arguments,1));return n.each(s,function(n){n in t&&(e[n]=t[n])}),e},n.extend=function(t){return n.each(i.call(arguments,1),function(e){if(e)for(var n in e)t[n]=e[n]}),t},n.keys=function(t){if(!n.isObject(t))return[];if(Object.keys)return Object.keys(t);var e=[];for(var i in t)n.has(t,i)&&e.push(i);return e},n.values=function(t){for(var e=e(t),n=e.length,i=new Array(n),r=0;n>r;r++)i[r]=t[e[r]];return i},n.isElement=function(t){return!(!t||1!==t.nodeType)},n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t){n["is"+t]=function(e){return s.call(e)=="[object "+t+"]"}}),n.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},n.isNaN=function(t){return n.isNumber(t)&&t!=+t},n.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==s.call(t)},n.isNull=function(t){return null===t},n.isUndefined=function(t){return void 0===t},n.has=function(t,e){return u.call(t,e)},t.prototype={queue:function(t){return this.list.push(t),this},dequeue:function(){function t(){e.dequeue()}var e=this,n=this.list.shift();return n&&n(t),this},delay:function(t){return this.queue(function(e){setTimeout(e,t)})},clear:function(){return this.list=[],this}},n.queue=function(){return new t},e.prototype={then:function(t,e,n){return t&&(t.finally?this.resolvedList.push(t):this.resolvedList.splice(this.resolvedListIndex++,0,t)),e&&(e.finally?this.rejectedList.push(e):this.rejectedList.splice(this.rejectedListIndex++,0,e)),n&&this.progressedList.push(n),"resolved"===this.state&&t&&t(this.args),"rejected"===this.state&&e&&e(this.args),this},resolve:function(t){if(this.args=t,"pending"!==this.state)return this;this.state="resolved";for(var e=0;e<this.resolvedList.length;e++)this.resolvedList[e](t);return this},reject:function(t){if(this.args=t,"pending"!==this.state)return this;this.state="rejected";for(var e=0;e<this.rejectedList.length;e++)this.rejectedList[e](t);return this},notify:function(t){for(var e=0;e<this.progressedList.length;e++)this.progressedList[e](t);return this},"finally":function(t){return t.finally=!0,this.then(t,t)}},n.defer=function(){return new e},n});