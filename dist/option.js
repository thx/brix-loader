define(["./constant.js","./util.js"],function(Constant,Util){function parseOptions(t){var e,n,a,r,s;if(a=t.getAttribute(Constant.ATTRS.id)){r=Constant.UUID++,t.getAttribute(Constant.ATTRS.cid)||t.setAttribute(Constant.ATTRS.cid,r),n=t;do n=n.parentNode;while(n&&9!==n.nodeType&&11!==n.nodeType&&!n.getAttribute(Constant.ATTRS.cid));s=n&&1===n.nodeType?+n.getAttribute(Constant.ATTRS.cid):-1,e=t.getAttribute(Constant.ATTRS.options);try{e=e?new Function("return "+e)():{}}catch(p){e={}}return e.element=t,e.moduleId=a,e.clientId=r,e.parentClientId=s,e.childClientIds=[],e.events=parseBxEvents(t),e}}function parseBxEvents(t,e){!t.nodeType&&t.length&&(t=t[0]);var n=e?t.getElementsByTagName("*"):[t],a=[];return Util.each(n,function(t){Util.each(t.attributes,function(e){var n=Constant.RE_EVENT.exec(e.name);if(n){var r={target:t,type:n[1],handler:e.value};Util.extend(r,parseFnAndParams(e.value)),a.push(r)}})}),a}function parsetBxTypes(t,e){return Util.unique(Util.map(parseBxEvents(t,e),function(t){return t.type}))}function parseFnAndParams(handler){var parts=Constant.FN_ARGS.exec(handler),fn,params;if(parts&&parts[1]){fn=parts[1],params=parts[2]||"";try{params=eval("(function(){ return [].splice.call(arguments, 0 ) })("+params+")")}catch(error){params=parts[2].split(/,\s*/)}return{fn:fn,params:params}}return{}}return{parseOptions:parseOptions,parseBxEvents:parseBxEvents,parsetBxTypes:parsetBxTypes,parseFnAndParams:parseFnAndParams}});